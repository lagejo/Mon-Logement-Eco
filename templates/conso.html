{% extends "base.html" %}

{% block title %}economie{% endblock %}

{% block content %}
<h1>Consommation</h1>

<form action="/consommation" method="get">
    <select name="logement_id" onchange="this.form.submit()">
        <option value="0" {% if not selected_logement %}selected{% endif %}>Sélectionner un logement</option>
        {% for logement in logements %}
            <option value="{{ logement.id_loge }}" {% if selected_logement and selected_logement == logement.id_loge %}selected{% endif %}>
                {{ logement.adresse }}
            </option>
        {% endfor %}
    </select>
</form>

{% if selected_logement %}
    {% if has_factures %}
        <h2>Montant total: {{ total_factures }} €</h2>
        <div id="piechart" style="width: 100%; height: 500px;"></div>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {
                var data = google.visualization.arrayToDataTable([
                    ['Type', 'Montant'],
                    {% for label, value in zip(labels, data) %}
                        ['{{ label }}', {{ value }}],
                    {% endfor %}
                ]);

                var formatter = new google.visualization.NumberFormat({
                    suffix: ' €',
                    decimalSymbol: ',',
                    groupingSymbol: ' '
                });
                formatter.format(data, 1);

                var options = {
                    title: 'Graphe des factures classées par type',
                    width: '100%',
                    height: 500,
                    tooltip: {
                        showColorCode: true,
                        text: 'value'
                    }
                };

                var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                chart.draw(data, options);
            }
        </script>
    {% else %}
        <p>Aucune facture trouvée pour ce logement.</p>
    {% endif %}
{% endif %}
{% endblock %}